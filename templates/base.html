<!doctype html>
<html lang="en">
<head>
    <title>kImventory System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">
    <h1 class="mb-4">ðŸ“¦ kImventory System</h1>

    <form id="scanForm" action="{{ url_for('scan_ean') }}" method="POST" placeholder="Scan or enter EAN">
        <div class="mb-3">
            <label for="ean">EAN</label>
            <input type="text" name="ean" id="ean" class="form-control" autofocus>
        </div>
        <div class="form-check form-switch">
          <input
            class="form-check-input"
            type="checkbox"
            role="switch"
            id="flexSwitchCheckChecked"
            name="flexSwitchCheckChecked"
            value="1" checked
          >
          <label class="form-check-label" for="flexSwitchCheckChecked">
            Scanned items are added to db
          </label>
        </div>

    </form>

    {% block content %}{% endblock %}

    <div style="position: fixed; bottom: 10px; right: 10px; text-align: center;">
        <img src="{{ url_for('static', filename='barcodes/3606480210389.jpg') }}"
             alt="Barcode"
             class="img-thumbnail"
             style="width:150px; cursor:pointer;"
             id="barcodeImg">
        <div style="font-size:12px; color:#888;">Click barcode to add</div>
    </div>

</body>
</html>

<script>
let eanInput   = document.getElementById("ean");
let scanForm   = document.getElementById("scanForm");
let barcodeImg = document.getElementById("barcodeImg"); // just for demo

// Always clear & focus on page load
window.onload = () => {
    eanInput.value = "";
    eanInput.focus();
};

// Debounce auto-submit on manual input
let debounceTimer;
eanInput.addEventListener("input", function() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
        if (this.value.length >= 6) {
            scanForm.requestSubmit();   // âœ… submit the full form with checkbox state
        }
    }, 400);
});

// Clickable barcode â†’ extract filename as EAN
barcodeImg.addEventListener("click", function() {
    let src = this.getAttribute("src");
    let filename = src.split("/").pop();
    let ean = filename.split(".")[0];

    eanInput.value = ean;
    scanForm.requestSubmit();              // âœ… ensures checkbox goes too
});

// After every form submit, reset & refocus input
scanForm.addEventListener("submit", () => {
    setTimeout(() => {
        eanInput.value = "";
        eanInput.focus();
    }, 100);
});
</script>
